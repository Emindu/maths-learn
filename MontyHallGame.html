<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monty Hall Game</title>
    <style>
        *,::after,::before{box-sizing:border-box}html{font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";line-height:1.5}body{margin:0}.min-h-screen{min-height:100vh}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity))}.flex{display:flex}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.gap-4{gap:1rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.px-4{padding-left:1rem;padding-right:1rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.font-bold{font-weight:700}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity))}.mb-4{margin-bottom:1rem}.max-w-2xl{max-width:42rem}.mx-auto{margin-left:auto;margin-right:auto}.mb-6{margin-bottom:1.5rem}.p-4{padding:1rem}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity))}.rounded-lg{border-radius:0.5rem}.shadow-md{box-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-2xl{font-size:1.5rem;line-height:2rem}.font-semibold{font-weight:600}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity))}.mb-2{margin-bottom:0.5rem}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity))}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-base{font-size:1rem;line-height:1.5rem}.list-disc{list-style-type:disc}.list-inside{list-style-position:inside}.mt-2{margin-top:0.5rem}.mt-6{margin-top:1.5rem}.relative{position:relative}.w-28{width:7rem}.h-44{height:11rem}.w-36{width:9rem}.h-56{height:14rem}.bg-indigo-600{--tw-bg-opacity:1;background-color:rgb(79 70 229 / var(--tw-bg-opacity))}.shadow-lg{box-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)}.cursor-pointer{cursor:pointer}.ring-4{--tw-ring-offset-width:4px;ring:4px}.ring-cyan-400{--tw-ring-opacity:1;--tw-ring-color:rgb(34 211 238 / var(--tw-ring-opacity))}.shadow-cyan-400\/50{--tw-shadow-color:#22d3ee;--tw-shadow:0 4px 6px -1px rgb(34 211 238 / 0.5), 0 2px 4px -2px rgb(34 211 238 / 0.5)}.bg-gray-300{--tw-bg-opacity:1;background-color:rgb(209 213 219 / var(--tw-bg-opacity))}.bg-yellow-400{--tw-bg-opacity:1;background-color:rgb(250 204 21 / var(--tw-bg-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity))}.text-black{--tw-text-opacity:1;color:rgb(0 0 0 / var(--tw-text-opacity))}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.w-16{width:4rem}.h-16{height:4rem}.w-20{width:5rem}.h-20{height:5rem}.sm\:w-20{width:5rem}.sm\:h-20{height:5rem}.opacity-100{opacity:1}.mt-4{margin-top:1rem}.max-w-xs{max-width:20rem}.text-center{text-align:center}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity))}.-top-2{top:-0.5rem}.w-4{width:1rem}.h-4{height:1rem}.rotate-45{--tw-rotate:45deg;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.p-3{padding:0.75rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity))}.bg-green-600{--tw-bg-opacity:1;background-color:rgb(22 163 74 / var(--tw-bg-opacity))}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity))}.hover\:bg-green-700:hover{--tw-bg-opacity:1;background-color:rgb(21 128 61 / var(--tw-bg-opacity))}.transition-colors{transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.w-full{width:100%}.h-full{height:100%}.max-w-md{max-width:28rem}.text-red-600{--tw-text-opacity:1;color:rgb(220 38 38 / var(--tw-text-opacity))}.bg-gray-900\/50{--tw-bg-opacity:1;background-color:rgb(17 24 39 / 0.5)}.fixed{position:fixed}.inset-0{top:0;right:0;bottom:0;left:0}.pointer-events-none{pointer-events:none}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.grayscale{--tw-grayscale:grayscale(100%);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.animate-pulse{animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite}.h-8{height:2rem}.bg-yellow-500{--tw-bg-opacity:1;background-color:rgb(234 179 8 / var(--tw-bg-opacity))}.inline-block{display:inline-block}.mx-1{margin-left:0.25rem;margin-right:0.25rem}.w-2{width:0.5rem}.absolute{position:absolute}.top-1\/2{top:50%}.left-1\/2{left:50%}.transform{transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-x-1\/2{--tw-translate-x:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-1\/2{--tw-translate-y:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.mt-12{margin-top:3rem}.object-contain{object-fit:contain}@keyframes pulse{50%{opacity:0.5}}.z-10{z-index:10}@media (min-width: 640px){.sm\:flex-row{flex-direction:row}.sm\:text-4xl{font-size:2.25rem;line-height:2.5rem}.sm\:text-2xl{font-size:1.5rem;line-height:2rem}.sm\:text-base{font-size:1rem;line-height:1.5rem}.sm\:text-xl{font-size:1.25rem;line-height:1.75rem}.sm\:w-36{width:9rem}.sm\:h-56{height:14rem}.sm\:w-20{width:5rem}.sm\:h-20{height:5rem}}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.6/babel.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/framer-motion@10.12.16/dist/framer-motion.min.js" crossorigin="anonymous"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Fallback for Framer Motion
        const motion = window.motion || {
            div: ({ children, ...props }) => <div {...props}>{children}</div>,
            img: ({ children, ...props }) => <img {...props} />,
        };
        if (!window.motion) {
            console.warn("Framer Motion not loaded; animations disabled.");
        }

        // Error Boundary Component
        class ErrorBoundary extends React.Component {
            state = { hasError: false, error: null };
            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }
            render() {
                if (this.state.hasError) {
                    return (
                        <div className="text-center p-4 text-red-600">
                            <h2>Something went wrong!</h2>
                            <p>{this.state.error?.message || "Unknown error"}</p>
                            <button
                                className="px-4 py-2 bg-blue-600 text-white rounded-lg"
                                onClick={() => window.location.reload()}
                            >
                                Reload
                            </button>
                        </div>
                    );
                }
                return this.props.children;
            }
        }

        // Confetti Effect
        const Confetti = ({ active, doorRef }) => {
            const canvasRef = useRef(null);

            useEffect(() => {
                if (!active || !canvasRef.current) return;

                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;

                const particles = [];
                const colors = ['#ff0', '#f00', '#0f0', '#00f', '#f0f'];

                for (let i = 0; i < 100; i++) {
                    particles.push({
                        x: doorRef.current ? doorRef.current.offsetLeft + doorRef.current.offsetWidth / 2 : canvas.width / 2,
                        y: doorRef.current ? doorRef.current.offsetTop : canvas.height / 2,
                        radius: Math.random() * 5 + 2,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        vx: Math.random() * 10 - 5,
                        vy: Math.random() * -10 - 5,
                        alpha: 1,
                    });
                }

                const animate = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    particles.forEach(p => {
                        p.x += p.vx;
                        p.y += p.vy;
                        p.vy += 0.2; // Gravity
                        p.alpha -= 0.01;
                        if (p.alpha <= 0) return;

                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                        ctx.fillStyle = p.color;
                        ctx.globalAlpha = p.alpha;
                        ctx.fill();
                    });

                    if (particles.some(p => p.alpha > 0)) {
                        requestAnimationFrame(animate);
                    }
                };

                animate();
                return () => ctx.clearRect(0, 0, canvas.width, canvas.height);
            }, [active]);

            return <canvas ref={canvasRef} className="fixed inset-0 pointer-events-none" />;
        };

        const Door = ({ number, isSelected, isOpen, isCar, onClick, isWinner, isLoser }) => {
            const doorRef = useRef(null);

            return (
                <>
                    {isWinner && <Confetti active={isWinner} doorRef={doorRef} />}
                    <motion.div
                        ref={doorRef}
                        onClick={onClick}
                        className={`relative w-28 h-44 sm:w-36 sm:h-56 bg-indigo-600 rounded-lg shadow-lg cursor-pointer flex items-center justify-center
                            ${isSelected ? 'ring-4 ring-cyan-400 shadow-cyan-400/50' : ''}
                            ${isOpen && isCar ? 'bg-yellow-400' : isOpen ? 'bg-gray-300' : ''}
                            ${isLoser ? 'filter grayscale' : ''}`}
                        initial={{ scale: 1 }}
                        animate={{
                            scale: isWinner ? [1.05, 1.15, 1.05] : isOpen ? 1.05 : 1,
                            x: isLoser ? [-5, 5, -5, 0] : 0,
                            boxShadow: isWinner ? [
                                '0 0 20px rgba(250, 204, 21, 0.8)',
                                '0 0 40px rgba(250, 204, 21, 1)',
                                '0 0 20px rgba(250, 204, 21, 0.8)'
                            ] : '0 10px 15px -3px rgba(0, 0, 0, 0.1)'
                        }}
                        transition={{
                            scale: { duration: isWinner ? 0.5 : 0.3, repeat: isWinner ? Infinity : 0 },
                            x: { duration: 0.4, repeat: isLoser ? 1 : 0 },
                            boxShadow: { duration: 0.5, repeat: isWinner ? Infinity : 0 }
                        }}
                        whileHover={{ scale: 1.05 }}
                    >
                        <span className={`text-lg sm:text-xl font-bold ${isOpen ? 'text-black' : 'text-white'}`}>
                            Door {number}
                        </span>
                        {isOpen && (
                            <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 sm:w-20 h-16 sm:h-20 flex items-center justify-center">
                                <motion.img
                                    src={isCar ? "https://cdn-icons-png.flaticon.com/512/3202/3202003.png" : "https://cdn-icons-png.flaticon.com/512/1886/1886933.png"}
                                    alt={isCar ? "Car" : "Goat"}
                                    className="w-full h-full object-contain object-[50%_50%]"
                                    initial={{ opacity: 0, scale: 0 }}
                                    animate={{ opacity: 1, scale: 1 }}
                                    transition={{ duration: 0.5 }}
                                />
                            </div>
                        )}
                        {isWinner && (
                            <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 mt-12 flex h-8 items-center">
                                <div className="inline-block w-2 h-8 bg-yellow-500 mx-1 animate-pulse"></div>
                                <div className="inline-block w-2 h-6 bg-yellow-500 mx-1 animate-pulse" style={{ animationDelay: '0.2s' }}></div>
                                <div className="inline-block w-2 h-4 bg-yellow-500 mx-1 animate-pulse" style={{ animationDelay: '0.4s' }}></div>
                            </div>
                        )}
                    </motion.div>
                </>
            );
        };

        const MontyInstructor = ({ message, gameState, isWinner, isLoser }) => {
            return (
                <motion.div
                    className="flex flex-col items-center mt-4"
                    initial={{ x: -100, opacity: 0 }}
                    animate={{ x: 0, opacity: 1 }}
                    transition={{ duration: 0.5, type: "spring", bounce: isWinner ? 0.6 : 0.4 }}
                >
                    <img
                        src="https://cdn-icons-png.flaticon.com/512/1998/1998671.png"
                        alt="Monty Host"
                        className="w-16 h-16 sm:w-20 sm:h-20 mb-2"
                    />
                    <motion.div
                        className="relative bg-white p-3 rounded-lg shadow-md max-w-xs text-center text-sm sm:text-base text-gray-700 z-10"
                        key={message}
                        initial={{ opacity: 0, y: 10, scale: isWinner ? 0.8 : 1 }}
                        animate={{ opacity: 1, y: 0, scale: isWinner ? [1, 1.1, 1] : 1 }}
                        transition={{ duration: isLoser ? 0.8 : 0.3, scale: { repeat: isWinner ? 1 : 0, duration: 0.5 } }}
                    >
                        <p>{message}</p>
                        <div className="absolute -top-2 left-1/2 transform -translate-x-1/2 w-4 h-4 bg-white rotate-45"></div>
                    </motion.div>
                </motion.div>
            );
        };

        const App = () => {
            const [gameState, setGameState] = useState('initial');
            const [carDoor, setCarDoor] = useState(null);
            const [selectedDoor, setSelectedDoor] = useState(null);
            const [montyOpensDoor, setMontyOpensDoor] = useState(null);
            const [message, setMessage] = useState('Pick a door, my friend! Let’s see if you’re driving home or herding goats!');
            const [showSimulate, setShowSimulate] = useState(false);
            const [simulationResults, setSimulationResults] = useState(null);
            const [isWinner, setIsWinner] = useState(false);
            const [isLoser, setIsLoser] = useState(false);
            const chartRef = useRef(null);
            const chartInstanceRef = useRef(null);

            const initializeGame = () => {
                setCarDoor(Math.floor(Math.random() * 3) + 1);
                setSelectedDoor(null);
                setMontyOpensDoor(null);
                setGameState('initial');
                setMessage('Pick a door, my friend! Let’s see if you’re driving home or herding goats!');
                setShowSimulate(false);
                setSimulationResults(null);
                setIsWinner(false);
                setIsLoser(false);
                if (chartInstanceRef.current) {
                    chartInstanceRef.current.destroy();
                    chartInstanceRef.current = null;
                }
            };

            const chooseDoor = (doorNumber) => {
                if (gameState === 'initial') {
                    setSelectedDoor(doorNumber);
                    const possibleOpens = [1, 2, 3].filter(d => d !== doorNumber && d !== carDoor);
                    const montyDoor = possibleOpens[Math.floor(Math.random() * possibleOpens.length)];
                    setMontyOpensDoor(montyDoor);
                    setGameState('firstPick');
                    setMessage(`Nice choice! I’ve opened Door ${montyDoor} to show a goat. Stay with Door ${doorNumber} or switch to the other door?`);
                } else if (gameState === 'firstPick' && doorNumber !== montyOpensDoor) {
                    setSelectedDoor(doorNumber);
                    setGameState('finished');
                    const won = doorNumber === carDoor;
                    setIsWinner(won);
                    setIsLoser(!won);
                    setMessage(`You chose Door ${doorNumber}! The car is behind Door ${carDoor}! ${won ? 'Vroom vroom! You’re a winner!' : 'Baa! Better luck next time!'}`);
                    setShowSimulate(true);
                }
            };

            const runSimulation = () => {
                const iterations = 10000;
                let stayWins = 0;
                let switchWins = 0;

                for (let i = 0; i < iterations; i++) {
                    const carDoorSim = Math.floor(Math.random() * 3) + 1;
                    const initialPickSim = Math.floor(Math.random() * 3) + 1;
                    const montyOpensSim = [1, 2, 3].filter(d => d !== carDoorSim && d !== initialPickSim)[0];
                    const switchPickSim = [1, 2, 3].filter(d => d !== initialPickSim && d !== montyOpensSim)[0];

                    if (initialPickSim === carDoorSim) stayWins++;
                    else switchWins++;
                }

                const stayWinRate = (stayWins / iterations) * 100;
                const switchWinRate = (switchWins / iterations) * 100;

                setSimulationResults({ stayWinRate, switchWinRate });
                setMessage(`Simulation of ${iterations} games done! Staying wins ${stayWinRate.toFixed(2)}%, Switching wins ${switchWinRate.toFixed(2)}%. Check the chart!`);
            };

            useEffect(() => {
                if (simulationResults && chartRef.current) {
                    if (chartInstanceRef.current) {
                        chartInstanceRef.current.destroy();
                    }
                    chartInstanceRef.current = new Chart(chartRef.current, {
                        type: 'bar',
                        data: {
                            labels: ['Stay', 'Switch'],
                            datasets: [{
                                label: 'Win Rate (%)',
                                data: [simulationResults.stayWinRate, simulationResults.switchWinRate],
                                backgroundColor: ['#60A5FA', '#F87171'],
                                borderColor: ['#2563EB', '#B91C1C'],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    title: { display: true, text: 'Win Rate (%)' }
                                }
                            },
                            plugins: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: 'Monty Hall Simulation Results'
                                }
                            }
                        }
                    });
                }
            }, [simulationResults]);

            useEffect(() => {
                initializeGame();
                console.log("Game initialized. All scripts loaded:", {
                    React: !!window.React,
                    ReactDOM: !!window.ReactDOM,
                    Chart: !!window.Chart,
                    motion: !!window.motion,
                });
            }, []);

            return (
                <ErrorBoundary>
                    <div className="min-h-screen bg-gray-100 flex flex-col items-center py-6 px-4 relative">
                        {isLoser && (
                            <motion.div
                                className="fixed inset-0 bg-gray-900/50 pointer-events-none"
                                initial={{ opacity: 0 }}
                                animate={{ opacity: 1 }}
                                transition={{ duration: 0.5 }}
                            />
                        )}
                        <h1 className="text-3xl sm:text-4xl font-bold text-blue-600 mb-4 z-10">Monty Hall Game</h1>
                        <div className="max-w-2xl mx-auto mb-6 p-4 bg-white rounded-lg shadow-md z-10">
                            <h2 className="text-xl sm:text-2xl font-semibold text-gray-800 mb-2">🎉 Welcome to the Monty Hall Show! 🎉</h2>
                            <p className="text-gray-600 text-sm sm:text-base">
                                Step right up for a wild ride! Behind one of these three mysterious doors hides a shiny new car 🚗, while the other two conceal... well, some very charming goats 🐐. Here's the deal:
                            </p>
                            <ul className="list-disc list-inside text-gray-600 text-sm sm:text-base mt-2">
                                <li>Pick a door—any door!</li>
                                <li>Your host, Monty, will slyly open one of the other doors to reveal a goat (he always knows where the car is, cheeky fella).</li>
                                <li>Now, the big moment: stick with your door or switch to the other unopened one?</li>
                                <li>Reveal your choice and see if you drive away or get a new furry friend!</li>
                            </ul>
                            <p className="text-gray-600 text-sm sm:text-base mt-2">
                                Feeling curious? Run a simulation of 10,000 games to uncover the secret strategy that could make you a Monty Hall legend! 🌟
                            </p>
                        </div>
                        <div className={`flex flex-col sm:flex-row gap-4 mb-6 ${isLoser ? 'filter grayscale' : ''}`}>
                            {[1, 2, 3].map(num => (
                                <Door
                                    key={num}
                                    number={num}
                                    isSelected={selectedDoor === num}
                                    isOpen={montyOpensDoor === num || gameState === 'finished'}
                                    isCar={carDoor === num && gameState === 'finished'}
                                    isWinner={isWinner && carDoor === num && gameState === 'finished'}
                                    isLoser={isLoser && selectedDoor === num && gameState === 'finished'}
                                    onClick={() => chooseDoor(num)}
                                />
                            ))}
                        </div>
                        <MontyInstructor message={message} gameState={gameState} isWinner={isWinner} isLoser={isLoser} />
                        <div className="flex gap-4 mb-6 mt-6 z-10">
                            <button
                                onClick={initializeGame}
                                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                            >
                                Reset
                            </button>
                            {showSimulate && (
                                <button
                                    onClick={runSimulation}
                                    className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                                >
                                    Simulate 10,000 Games
                                </button>
                            )}
                        </div>
                        {simulationResults && (
                            <div className="w-full max-w-md z-10">
                                <canvas ref={chartRef}></canvas>
                            </div>
                        )}
                    </div>
                </ErrorBoundary>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
